<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ST558_2024_HW8_bike data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ST558_2024_HW8_bike data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="basic-modeling-practise" class="level1">
<h1>Basic Modeling Practise</h1>
<section id="data-introduction" class="level2">
<h2 class="anchored" data-anchor-id="data-introduction">Data introduction</h2>
<p>Today we are using a bike share data for the basic modeling practise. The introoduction of this data set is accessed through this website: (Seoul Bike Sharing Demand - UCI Machine Learning Repository). To our relieve there is no missing values.</p>
<p>The aim of the project is to predict the rental bike count at each hour of a day based on the weather condition, season, holiday and the hour. Since bike usage is sensitive to weather condition it is presumable that certain weather condition, plus the day condition (weekday/weekend, holiday, etc.) is likely to dictate the bike usage in a particular time of the day.</p>
<p>Let’s load some packages and read in the data first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lubridate' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Bikeshare <span class="ot">&lt;-</span> <span class="fu">read_csv</span> (<span class="st">"data//SeoulBikeData.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8760 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Date, Seasons, Holiday, Functioning Day
dbl (10): Rented Bike Count, Hour, Temperature(C), Humidity(%), Wind speed (...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Bikeshare</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,760 × 14
   Date      `Rented Bike Count`  Hour `Temperature(C)` `Humidity(%)`
   &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;
 1 1/12/2017                 254     0             -5.2            37
 2 1/12/2017                 204     1             -5.5            38
 3 1/12/2017                 173     2             -6              39
 4 1/12/2017                 107     3             -6.2            40
 5 1/12/2017                  78     4             -6              36
 6 1/12/2017                 100     5             -6.4            37
 7 1/12/2017                 181     6             -6.6            35
 8 1/12/2017                 460     7             -7.4            38
 9 1/12/2017                 930     8             -7.6            37
10 1/12/2017                 490     9             -6.5            27
# ℹ 8,750 more rows
# ℹ 9 more variables: `Wind speed (m/s)` &lt;dbl&gt;, `Visibility (10m)` &lt;dbl&gt;,
#   `Dew point temperature(C)` &lt;dbl&gt;, `Solar Radiation (MJ/m2)` &lt;dbl&gt;,
#   `Rainfall(mm)` &lt;dbl&gt;, `Snowfall (cm)` &lt;dbl&gt;, Seasons &lt;chr&gt;, Holiday &lt;chr&gt;,
#   `Functioning Day` &lt;chr&gt;</code></pre>
</div>
</div>
<p>Unexpectedly the first trial to read in data failed. It turned out the file contains some special character that the R does not understand/not encoded by the R-recognizable way.</p>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<p>After changing the format manually everything is fine. We first transform the date to the date format</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Bikeshare<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span> (Bikeshare<span class="sc">$</span>Date, <span class="at">format =</span> <span class="st">"%d/%m/%Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the date are in the right form and can do some visualization around the time data, which we will work on that later. Missing values are creating a headache for exploratory data analysis, so we want to check for missingness, evaluate and take measures to eliminate the missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(Bikeshare))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Date        Rented Bike Count                     Hour 
                       0                        0                        0 
          Temperature(C)              Humidity(%)         Wind speed (m/s) 
                       0                        0                        0 
        Visibility (10m) Dew point temperature(C)  Solar Radiation (MJ/m2) 
                       0                        0                        0 
            Rainfall(mm)            Snowfall (cm)                  Seasons 
                       0                        0                        0 
                 Holiday          Functioning Day 
                       0                        0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(Bikeshare<span class="sc">$</span>Seasons))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>Luckily for us, there is no missing data in the data set. To check for the number of unique values in each character column, use the command table(), and if everything is right turn the character variables into factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Bikeshare<span class="sc">$</span>Seasons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Autumn Spring Summer Winter 
  2184   2208   2208   2160 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span> (Bikeshare<span class="sc">$</span>Holiday)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Holiday No Holiday 
       432       8328 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span> (Bikeshare<span class="sc">$</span><span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  No  Yes 
 295 8465 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Bikeshare <span class="ot">&lt;-</span> Bikeshare <span class="sc">|&gt;</span> <span class="fu">mutate</span> (<span class="at">SeasonsF =</span> <span class="fu">as.factor</span> (Seasons),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">HolidayF =</span> <span class="fu">as.factor</span> (Holiday)) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (<span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (<span class="sc">-</span>Seasons, <span class="sc">-</span>Holiday, <span class="sc">-</span><span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We filtered the data so that all days recorded were “functional day” and factorized variables “Seasons” and “Holiday”. Since we wanted to summarize across the hours to simplify the data (thus eliminating the need to adjust for the hour variable), we will hereby factorize date as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Bikeshare <span class="ot">&lt;-</span> Bikeshare <span class="sc">|&gt;</span> <span class="fu">mutate</span> (<span class="at">DateF =</span> <span class="fu">as.factor</span> (Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are ready to do some EDA.</p>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory data analysis</h2>
<p>Let’s first do summary over some variables. We already counted the number of each unique factors of the categorical variables, we could summarize them as below. First let’s take a look at the variables of the modified data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (Bikeshare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [8,465 × 14] (S3: tbl_df/tbl/data.frame)
 $ Date                    : Date[1:8465], format: "2017-12-01" "2017-12-01" ...
 $ Rented Bike Count       : num [1:8465] 254 204 173 107 78 100 181 460 930 490 ...
 $ Hour                    : num [1:8465] 0 1 2 3 4 5 6 7 8 9 ...
 $ Temperature(C)          : num [1:8465] -5.2 -5.5 -6 -6.2 -6 -6.4 -6.6 -7.4 -7.6 -6.5 ...
 $ Humidity(%)             : num [1:8465] 37 38 39 40 36 37 35 38 37 27 ...
 $ Wind speed (m/s)        : num [1:8465] 2.2 0.8 1 0.9 2.3 1.5 1.3 0.9 1.1 0.5 ...
 $ Visibility (10m)        : num [1:8465] 2000 2000 2000 2000 2000 ...
 $ Dew point temperature(C): num [1:8465] -17.6 -17.6 -17.7 -17.6 -18.6 -18.7 -19.5 -19.3 -19.8 -22.4 ...
 $ Solar Radiation (MJ/m2) : num [1:8465] 0 0 0 0 0 0 0 0 0.01 0.23 ...
 $ Rainfall(mm)            : num [1:8465] 0 0 0 0 0 0 0 0 0 0 ...
 $ Snowfall (cm)           : num [1:8465] 0 0 0 0 0 0 0 0 0 0 ...
 $ SeasonsF                : Factor w/ 4 levels "Autumn","Spring",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ HolidayF                : Factor w/ 2 levels "Holiday","No Holiday": 2 2 2 2 2 2 2 2 2 2 ...
 $ DateF                   : Factor w/ 353 levels "2017-12-01","2017-12-02",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<p>For the variable “Rented Bike Count”, “Rainfall (mm)”, “Snowfall (cm)”, we would like to get summary data based on the <strong>summed</strong> value in a day (added up all the hour data). For other weather-related data, we would like to get a summary of the <strong>mean</strong> across all the hours in a day.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>rentalcount_precipitation_summary <span class="ot">&lt;-</span>Bikeshare <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Date) <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> (<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">Rented Bike Count</span><span class="st">`</span>,<span class="st">`</span><span class="at">Rainfall(mm)</span><span class="st">`</span>,<span class="st">`</span><span class="at">Snowfall (cm)</span><span class="st">`</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">.fns =</span> <span class="fu">list</span> (<span class="st">"Daily"</span> <span class="ot">=</span> sum)))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rentalcount_precipitation_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Date            Rented Bike Count_Daily Rainfall(mm)_Daily
 Min.   :2017-12-01   Min.   :  977           Min.   : 0.000    
 1st Qu.:2018-02-27   1st Qu.: 6967           1st Qu.: 0.000    
 Median :2018-05-28   Median :18563           Median : 0.000    
 Mean   :2018-05-28   Mean   :17485           Mean   : 3.576    
 3rd Qu.:2018-08-24   3rd Qu.:26285           3rd Qu.: 0.500    
 Max.   :2018-11-30   Max.   :36149           Max.   :95.500    
 Snowfall (cm)_Daily
 Min.   : 0.000     
 1st Qu.: 0.000     
 Median : 0.000     
 Mean   : 1.863     
 3rd Qu.: 0.000     
 Max.   :78.700     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>weather_summary <span class="ot">&lt;-</span> Bikeshare <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Date) <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> (<span class="fu">across</span> (<span class="fu">c</span>(<span class="st">`</span><span class="at">Temperature(C)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Humidity(%)</span><span class="st">`</span>,<span class="st">`</span><span class="at">Wind speed (m/s)</span><span class="st">`</span>,<span class="st">`</span><span class="at">Visibility (10m)</span><span class="st">`</span>,<span class="st">`</span><span class="at">Dew point temperature(C)</span><span class="st">`</span>,<span class="st">`</span><span class="at">Solar Radiation (MJ/m2)</span><span class="st">`</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.fns =</span> <span class="fu">list</span> (<span class="st">"Daily"</span> <span class="ot">=</span> mean)))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span> (weather_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Date            Temperature(C)_Daily Humidity(%)_Daily
 Min.   :2017-12-01   Min.   :-14.738      Min.   :22.25    
 1st Qu.:2018-02-27   1st Qu.:  3.304      1st Qu.:47.58    
 Median :2018-05-28   Median : 13.738      Median :57.17    
 Mean   :2018-05-28   Mean   : 12.776      Mean   :58.17    
 3rd Qu.:2018-08-24   3rd Qu.: 22.592      3rd Qu.:67.71    
 Max.   :2018-11-30   Max.   : 33.742      Max.   :95.88    
 Wind speed (m/s)_Daily Visibility (10m)_Daily Dew point temperature(C)_Daily
 Min.   :0.6625         Min.   : 214.3         Min.   :-27.750               
 1st Qu.:1.3042         1st Qu.:1087.0         1st Qu.: -5.188               
 Median :1.6583         Median :1557.8         Median :  4.612               
 Mean   :1.7261         Mean   :1434.0         Mean   :  3.954               
 3rd Qu.:1.9542         3rd Qu.:1874.3         3rd Qu.: 14.921               
 Max.   :4.0000         Max.   :2000.0         Max.   : 25.038               
 Solar Radiation (MJ/m2)_Daily
 Min.   :0.02917              
 1st Qu.:0.28333              
 Median :0.56500              
 Mean   :0.56773              
 3rd Qu.:0.82000              
 Max.   :1.21667              </code></pre>
</div>
</div>
<p>We could combine the two data set into one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Bikesharenew <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rentalcount_precipitation_summary,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                          weather_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Date)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Bikesharenew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [353 × 10] (S3: tbl_df/tbl/data.frame)
 $ Date                          : Date[1:353], format: "2017-12-01" "2017-12-02" ...
 $ Rented Bike Count_Daily       : num [1:353] 9539 8523 7222 8729 8307 ...
 $ Rainfall(mm)_Daily            : num [1:353] 0 0 4 0.1 0 1.3 0 0 0 4.1 ...
 $ Snowfall (cm)_Daily           : num [1:353] 0 0 0 0 0 8.6 10.4 0 0 32.5 ...
 $ Temperature(C)_Daily          : num [1:353] -2.454 1.325 4.875 -0.304 -4.458 ...
 $ Humidity(%)_Daily             : num [1:353] 45.9 62 81.5 52.5 36.4 ...
 $ Wind speed (m/s)_Daily        : num [1:353] 1.54 1.71 1.61 3.45 1.11 ...
 $ Visibility (10m)_Daily        : num [1:353] 1871 1471 456 1363 1959 ...
 $ Dew point temperature(C)_Daily: num [1:353] -13.55 -5.72 1.88 -9.93 -17.43 ...
 $ Solar Radiation (MJ/m2)_Daily : num [1:353] 0.2487 0.2637 0.1254 0.2829 0.0358 ...</code></pre>
</div>
</div>
<p>Based on the merged data set, we will do more work – To better visualize the distribution of variables, histogram seemed to be the choice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>rentalcount <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> <span class="st">`</span><span class="at">Rented Bike Count_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"red3"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily rented Bike Count"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>rainfall <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> <span class="st">`</span><span class="at">Rainfall(mm)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily rainfall (mm)"</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>snowfall <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Snowfall (cm)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"brown"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily snowfall (cm)"</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>Temperature <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Temperature(C)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily avg Temp (oC)"</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>Humidity <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Humidity(%)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily avg Humidity (%)"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>windspeed <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Wind speed (m/s)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"lightblue4"</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily avg windspeed (m/s)"</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>visibility <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Visibility (10m)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily avg Visibility (10m)"</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>dewpoint <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Dew point temperature(C)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">fill =</span> <span class="st">"ivory"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily avg dew point temp (oC)"</span>)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>solar <span class="ot">&lt;-</span> <span class="fu">ggplot</span> (Bikesharenew, <span class="fu">aes</span> (<span class="at">x =</span> Bikesharenew<span class="sc">$</span><span class="st">`</span><span class="at">Solar Radiation (MJ/m2)_Daily</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="st">"orange2"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Daily avg solar radiation (MJ/m2)"</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(rentalcount,rainfall,snowfall,Temperature,Humidity,windspeed,visibility,dewpoint,solar, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Snowfall (cm)_Daily` `` is discouraged.
ℹ Use `Snowfall (cm)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Temperature(C)_Daily` `` is discouraged.
ℹ Use `Temperature(C)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Humidity(%)_Daily` `` is discouraged.
ℹ Use `Humidity(%)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Wind speed (m/s)_Daily` `` is discouraged.
ℹ Use `Wind speed (m/s)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Visibility (10m)_Daily` `` is discouraged.
ℹ Use `Visibility (10m)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Dew point temperature(C)_Daily` `` is discouraged.
ℹ Use `Dew point temperature(C)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Use of `` Bikesharenew$`Solar Radiation (MJ/m2)_Daily` `` is discouraged.
ℹ Use `Solar Radiation (MJ/m2)_Daily` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="HW8_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is interesting to see the rough bi-modal distribution of rented bike count. neither <strong>mean</strong> nor <strong>median</strong> fall on either peak. Probably it is just good and bad weather conditions that is driving this division.</p>
<p>In order to assist data modeling, not only we are interested in which variable contributes the most to the changes of bike rental count, but also we wanted to figure out the correlation among different predictors. Thus we would use corr plot to visualize the relationship</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'corrplot' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.94 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(Bikesharenew <span class="sc">|&gt;</span> <span class="fu">select</span> (<span class="sc">-</span>Date))  <span class="co"># Compute correlation matrix</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"circle"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">tl.cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="HW8_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this correlation plot it is easy to see the daily number of checked out bike is highly positively correlated with the daily temperature, dewpoint and solar radiation. However since both dewpoint and solar radiation are highly correlated with the temperature themselves, we will wait to see whether we should include them all. On the contrary, daily rainfall, snowfall or windspeed is negatively associated with bike count. But remember the distribution of those three variable is far from normal distribution, so maybe it would help to transform the three variables into categorical variables to better model the bike rental count.</p>
</section>
<section id="split-the-data" class="level2">
<h2 class="anchored" data-anchor-id="split-the-data">Split the data</h2>
<p>Now we could model our data Bikesharenew. First let’s split them using seasons to stratify. However we missed the categorical variables in the original data set. Let’s fix this first!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>Bikeshare_cat <span class="ot">&lt;-</span> Bikeshare <span class="sc">|&gt;</span> <span class="fu">select</span> (Date, SeasonsF, HolidayF) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (Bikeshare_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [353 × 3] (S3: tbl_df/tbl/data.frame)
 $ Date    : Date[1:353], format: "2017-12-01" "2017-12-02" ...
 $ SeasonsF: Factor w/ 4 levels "Autumn","Spring",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ HolidayF: Factor w/ 2 levels "Holiday","No Holiday": 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>Bikesharenew2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(Bikesharenew, Bikeshare_cat, <span class="at">by =</span> <span class="fu">join_by</span>(Date))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (Bikesharenew2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [353 × 12] (S3: tbl_df/tbl/data.frame)
 $ Date                          : Date[1:353], format: "2017-12-01" "2017-12-02" ...
 $ Rented Bike Count_Daily       : num [1:353] 9539 8523 7222 8729 8307 ...
 $ Rainfall(mm)_Daily            : num [1:353] 0 0 4 0.1 0 1.3 0 0 0 4.1 ...
 $ Snowfall (cm)_Daily           : num [1:353] 0 0 0 0 0 8.6 10.4 0 0 32.5 ...
 $ Temperature(C)_Daily          : num [1:353] -2.454 1.325 4.875 -0.304 -4.458 ...
 $ Humidity(%)_Daily             : num [1:353] 45.9 62 81.5 52.5 36.4 ...
 $ Wind speed (m/s)_Daily        : num [1:353] 1.54 1.71 1.61 3.45 1.11 ...
 $ Visibility (10m)_Daily        : num [1:353] 1871 1471 456 1363 1959 ...
 $ Dew point temperature(C)_Daily: num [1:353] -13.55 -5.72 1.88 -9.93 -17.43 ...
 $ Solar Radiation (MJ/m2)_Daily : num [1:353] 0.2487 0.2637 0.1254 0.2829 0.0358 ...
 $ SeasonsF                      : Factor w/ 4 levels "Autumn","Spring",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ HolidayF                      : Factor w/ 2 levels "Holiday","No Holiday": 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
</div>
</div>
<p>Here we inspect the column names for the <strong>Bikesharenew2</strong> data frame and found they could prove to be problematic. Change them now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>newnames <span class="ot">&lt;-</span> <span class="fu">c</span> (<span class="st">"Rainfall_daily"</span>, <span class="st">"Snowfall_daily"</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"TempC_daily"</span>, <span class="st">"Humidity_daily"</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Windspeed_daily"</span>, <span class="st">"Visibility_daily"</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"DewtempC_daily"</span>, <span class="st">"solarrad_daily"</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span> (Bikesharenew2) [<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>] <span class="ot">&lt;-</span> newnames</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (Bikesharenew2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [353 × 12] (S3: tbl_df/tbl/data.frame)
 $ Date                   : Date[1:353], format: "2017-12-01" "2017-12-02" ...
 $ Rented Bike Count_Daily: num [1:353] 9539 8523 7222 8729 8307 ...
 $ Rainfall_daily         : num [1:353] 0 0 4 0.1 0 1.3 0 0 0 4.1 ...
 $ Snowfall_daily         : num [1:353] 0 0 0 0 0 8.6 10.4 0 0 32.5 ...
 $ TempC_daily            : num [1:353] -2.454 1.325 4.875 -0.304 -4.458 ...
 $ Humidity_daily         : num [1:353] 45.9 62 81.5 52.5 36.4 ...
 $ Windspeed_daily        : num [1:353] 1.54 1.71 1.61 3.45 1.11 ...
 $ Visibility_daily       : num [1:353] 1871 1471 456 1363 1959 ...
 $ DewtempC_daily         : num [1:353] -13.55 -5.72 1.88 -9.93 -17.43 ...
 $ solarrad_daily         : num [1:353] 0.2487 0.2637 0.1254 0.2829 0.0358 ...
 $ SeasonsF               : Factor w/ 4 levels "Autumn","Spring",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ HolidayF               : Factor w/ 2 levels "Holiday","No Holiday": 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
</div>
</div>
<p>Now it’s all good and we could proceed with splitting the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidymodels' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.2.0 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.7     ✔ rsample      1.2.1
✔ dials        1.3.0     ✔ tune         1.2.1
✔ infer        1.0.7     ✔ workflows    1.1.4
✔ modeldata    1.4.0     ✔ workflowsets 1.1.0
✔ parsnip      1.2.1     ✔ yardstick    1.3.1
✔ recipes      1.1.0     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'broom' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dials' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'scales' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'infer' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'modeldata' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'parsnip' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'recipes' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'rsample' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tune' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'workflows' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'workflowsets' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'yardstick' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ gridExtra::combine() masks dplyr::combine()
✖ scales::discard()    masks purrr::discard()
✖ dplyr::filter()      masks stats::filter()
✖ recipes::fixed()     masks stringr::fixed()
✖ dplyr::lag()         masks stats::lag()
✖ yardstick::spec()    masks readr::spec()
✖ recipes::step()      masks stats::step()
• Learn how to get started at https://www.tidymodels.org/start/</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>Bikesharesplit <span class="ot">&lt;-</span> <span class="fu">initial_split</span> (Bikesharenew2, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> SeasonsF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now create a 10-fold CV on training set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>bikesharetrain <span class="ot">&lt;-</span> <span class="fu">training</span> (Bikesharesplit)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>bikeshare_10_fold <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(bikesharetrain,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mlr-model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="mlr-model-fitting">MLR model fitting</h2>
<p>Now let’s create three different recipe, with the first recipe only considering simple linear regression model. Use the recipe () and bake () to see if it works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recipe</span> (<span class="st">`</span><span class="at">Rented Bike Count_Daily</span><span class="st">`</span> <span class="sc">~</span>., <span class="at">data =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span> (Date, <span class="at">features =</span> <span class="st">"dow"</span>) <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Date_dow =</span> <span class="fu">as.character</span>(Date_dow)) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">ifelse</span>(Date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="st">"weekend"</span>, <span class="st">"weekday"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">factor</span> (Days, <span class="at">levels =</span> <span class="fu">c</span> (<span class="st">"weekend"</span>, <span class="st">"weekdays"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span> (<span class="fu">all_numeric</span>(),<span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_unknown</span> (Days, <span class="at">new_level =</span> <span class="st">"unknown days"</span>) <span class="sc">|&gt;</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span> (SeasonsF, HolidayF, Days) <span class="sc">|&gt;</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span> (<span class="at">training =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span> (bikesharetrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 263 × 17
   Date       Rainfall_daily Snowfall_daily TempC_daily Humidity_daily
   &lt;date&gt;              &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
 1 2018-09-03          2.67          -0.183       0.931          1.57 
 2 2018-09-04         -0.316         -0.183       0.901          0.883
 3 2018-09-05         -0.316         -0.183       0.951          0.245
 4 2018-09-09         -0.316         -0.183       0.791         -0.556
 5 2018-09-10         -0.316         -0.183       0.875         -0.515
 6 2018-09-11         -0.316         -0.183       0.757         -0.653
 7 2018-09-13         -0.316         -0.183       0.918          0.277
 8 2018-09-15         -0.298         -0.183       0.898          1.16 
 9 2018-09-16         -0.143         -0.183       0.823          1.62 
10 2018-09-17         -0.307         -0.183       0.822          0.432
# ℹ 253 more rows
# ℹ 12 more variables: Windspeed_daily &lt;dbl&gt;, Visibility_daily &lt;dbl&gt;,
#   DewtempC_daily &lt;dbl&gt;, solarrad_daily &lt;dbl&gt;,
#   `Rented Bike Count_Daily` &lt;dbl&gt;, Date_dow &lt;chr&gt;, SeasonsF_Spring &lt;dbl&gt;,
#   SeasonsF_Summer &lt;dbl&gt;, SeasonsF_Winter &lt;dbl&gt;, HolidayF_No.Holiday &lt;dbl&gt;,
#   Days_weekdays &lt;dbl&gt;, Days_unknown.days &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Well, it seemed to work. Apply this to the first recipe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>bikeshare_rec_1 <span class="ot">&lt;-</span> <span class="fu">recipe</span> (<span class="st">`</span><span class="at">Rented Bike Count_Daily</span><span class="st">`</span> <span class="sc">~</span>., <span class="at">data =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span> (Date, <span class="at">features =</span> <span class="st">"dow"</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Date_dow =</span> <span class="fu">as.character</span>(Date_dow)) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">ifelse</span>(Date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="st">"weekend"</span>, <span class="st">"weekday"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">factor</span> (Days, <span class="at">levels =</span> <span class="fu">c</span> (<span class="st">"weekend"</span>, <span class="st">"weekdays"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span> (<span class="fu">all_numeric</span>(),<span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_unknown</span> (Days, <span class="at">new_level =</span> <span class="st">"unknown days"</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span> (SeasonsF, HolidayF, Days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s create the 2nd recipe, adding several interactions while keeping most of the recipe unchanged.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recipe</span> (<span class="st">`</span><span class="at">Rented Bike Count_Daily</span><span class="st">`</span> <span class="sc">~</span>., <span class="at">data =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span> (Date, <span class="at">features =</span> <span class="st">"dow"</span>) <span class="sc">|&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Date_dow =</span> <span class="fu">as.character</span>(Date_dow)) <span class="sc">|&gt;</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">ifelse</span>(Date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="st">"weekend"</span>, <span class="st">"weekday"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">factor</span> (Days, <span class="at">levels =</span> <span class="fu">c</span> (<span class="st">"weekend"</span>, <span class="st">"weekdays"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span> (<span class="fu">all_numeric</span>(),<span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_unknown</span> (Days, <span class="at">new_level =</span> <span class="st">"unknown days"</span>) <span class="sc">|&gt;</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span> (SeasonsF, HolidayF, Days) <span class="sc">|&gt;</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span> (<span class="at">terms =</span> <span class="sc">~</span> <span class="fu">starts_with</span> (<span class="st">"Season"</span>) <span class="sc">*</span> HolidayF_No.Holiday <span class="sc">+</span> </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">starts_with</span>(<span class="st">"Season"</span>) <span class="sc">*</span> TempC_daily <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                  TempC_daily <span class="sc">*</span> Rainfall_daily) <span class="sc">|&gt;</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span> (<span class="at">training =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span> (bikesharetrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 263 × 24
   Date       Rainfall_daily Snowfall_daily TempC_daily Humidity_daily
   &lt;date&gt;              &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
 1 2018-09-03          2.67          -0.183       0.931          1.57 
 2 2018-09-04         -0.316         -0.183       0.901          0.883
 3 2018-09-05         -0.316         -0.183       0.951          0.245
 4 2018-09-09         -0.316         -0.183       0.791         -0.556
 5 2018-09-10         -0.316         -0.183       0.875         -0.515
 6 2018-09-11         -0.316         -0.183       0.757         -0.653
 7 2018-09-13         -0.316         -0.183       0.918          0.277
 8 2018-09-15         -0.298         -0.183       0.898          1.16 
 9 2018-09-16         -0.143         -0.183       0.823          1.62 
10 2018-09-17         -0.307         -0.183       0.822          0.432
# ℹ 253 more rows
# ℹ 19 more variables: Windspeed_daily &lt;dbl&gt;, Visibility_daily &lt;dbl&gt;,
#   DewtempC_daily &lt;dbl&gt;, solarrad_daily &lt;dbl&gt;,
#   `Rented Bike Count_Daily` &lt;dbl&gt;, Date_dow &lt;chr&gt;, SeasonsF_Spring &lt;dbl&gt;,
#   SeasonsF_Summer &lt;dbl&gt;, SeasonsF_Winter &lt;dbl&gt;, HolidayF_No.Holiday &lt;dbl&gt;,
#   Days_weekdays &lt;dbl&gt;, Days_unknown.days &lt;dbl&gt;,
#   SeasonsF_Spring_x_HolidayF_No.Holiday &lt;dbl&gt;, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>bikeshare_rec_2 <span class="ot">&lt;-</span> <span class="fu">recipe</span> (<span class="st">`</span><span class="at">Rented Bike Count_Daily</span><span class="st">`</span> <span class="sc">~</span>., <span class="at">data =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span> (Date, <span class="at">features =</span> <span class="st">"dow"</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Date_dow =</span> <span class="fu">as.character</span>(Date_dow)) <span class="sc">|&gt;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">ifelse</span>(Date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="st">"weekend"</span>, <span class="st">"weekday"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">factor</span> (Days, <span class="at">levels =</span> <span class="fu">c</span> (<span class="st">"weekend"</span>, <span class="st">"weekdays"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span> (<span class="fu">all_numeric</span>(),<span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_unknown</span> (Days, <span class="at">new_level =</span> <span class="st">"unknown"</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span> (SeasonsF, HolidayF, Days) <span class="sc">|&gt;</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span> (<span class="at">terms =</span> <span class="sc">~</span> <span class="fu">starts_with</span> (<span class="st">"Season"</span>) <span class="sc">*</span> HolidayF_No.Holiday <span class="sc">+</span> </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">starts_with</span>(<span class="st">"Season"</span>) <span class="sc">*</span> TempC_daily <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>                  TempC_daily <span class="sc">*</span> Rainfall_daily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Proceed to add the 3rd recipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>bikeshare_rec_3 <span class="ot">&lt;-</span> <span class="fu">recipe</span> (<span class="st">`</span><span class="at">Rented Bike Count_Daily</span><span class="st">`</span> <span class="sc">~</span>., <span class="at">data =</span> bikesharetrain) <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span> (Date, <span class="at">features =</span> <span class="st">"dow"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Date_dow =</span> <span class="fu">as.character</span>(Date_dow)) <span class="sc">|&gt;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">ifelse</span>(Date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="st">"weekend"</span>, <span class="st">"weekday"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span> (<span class="at">Days =</span> <span class="fu">factor</span> (Days, <span class="at">levels =</span> <span class="fu">c</span> (<span class="st">"weekend"</span>, <span class="st">"weekdays"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span> (<span class="fu">all_numeric</span>(),<span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_unknown</span> (Days, <span class="at">new_level =</span> <span class="st">"unknown"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span> (SeasonsF, HolidayF, Days) <span class="sc">|&gt;</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span> (<span class="at">terms =</span> <span class="sc">~</span> <span class="fu">starts_with</span> (<span class="st">"Season"</span>) <span class="sc">*</span> HolidayF_No.Holiday <span class="sc">+</span> </span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">starts_with</span>(<span class="st">"Season"</span>) <span class="sc">*</span> TempC_daily <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>                  TempC_daily <span class="sc">*</span> Rainfall_daily) <span class="sc">|&gt;</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span> (Rainfall_daily, Snowfall_daily, Windspeed_daily, solarrad_daily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There was an error saying the <em>degree</em> of the polynomial needs to be smaller than the unique number of a variable, but according to my observation all numeric variable has more than two unique values. This I do not understand, but I manually chose some anyway.</p>
<p>Now set up our linear model to the engine “lm”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>bikeshare_mod <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span> (<span class="st">"lm"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>bikeshare_wfl_1 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> <span class="fu">add_recipe</span> (bikeshare_rec_1) <span class="sc">|&gt;</span> <span class="fu">add_model</span> (bikeshare_mod)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>bikeshare_wfl_2 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> <span class="fu">add_recipe</span> (bikeshare_rec_2) <span class="sc">|&gt;</span> <span class="fu">add_model</span> (bikeshare_mod)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>bikeshare_wfl_3 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> <span class="fu">add_recipe</span> (bikeshare_rec_3) <span class="sc">|&gt;</span> <span class="fu">add_model</span> (bikeshare_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are using the CV data to fit the three different models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>bikeshare_cv_fit_1 <span class="ot">&lt;-</span> bikeshare_wfl_1 <span class="sc">|&gt;</span> <span class="fu">fit_resamples</span> (bikeshare_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x9</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>bikeshare_cv_fit_2 <span class="ot">&lt;-</span> bikeshare_wfl_2 <span class="sc">|&gt;</span> <span class="fu">fit_resamples</span> (bikeshare_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10
There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>bikeshare_cv_fit_3 <span class="ot">&lt;-</span> bikeshare_wfl_3 <span class="sc">|&gt;</span> <span class="fu">fit_resamples</span> (bikeshare_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x8</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span> ((bikeshare_cv_fit_1 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()),</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>(bikeshare_cv_fit_2 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>(bikeshare_cv_fit_3 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  .metric .estimator     mean     n   std_err .config             
  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   4119.       10 220.      Preprocessor1_Model1
2 rsq     standard      0.834    10   0.0200  Preprocessor1_Model1
3 rmse    standard   2752.       10 129.      Preprocessor1_Model1
4 rsq     standard      0.923    10   0.00672 Preprocessor1_Model1
5 rmse    standard   2640.       10 109.      Preprocessor1_Model1
6 rsq     standard      0.930    10   0.00561 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Well, our data showed adding some interaction terms and polynomial terms indeed improved the model, as the mean RMSE reduced, but the value of RSQ did not reduce, meaning adding a lot of interaction term did not improve too much of our model. Since we already observed some linear relationship among several predictors, we could manually add some interaction partners.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>